/*! -------------------------------------------------------
 * CPP.js
 * - javascript bundle for cpp.sh
 *                (c) 2014, Juan Soulie <juan@soulie.com>
 * -------------------------------------------------------
*/
;if(!Element.prototype.addEventListener&&Element.prototype.attachEvent){Element.prototype.addEventListener=function(b,a){this.attachEvent("on"+b,a)};Element.prototype.removeEventListener=function(b,a){this.detachEvent("on"+b,a)}}if(Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get){(function(){var a=Object.getOwnPropertyDescriptor(Element.prototype,"innerText");Object.defineProperty(Element.prototype,"textContent",{get:function(){return a.get.call(this)},set:function(b){return a.set.call(this,b)}})})()}var dom=(function(){dom={};dom.ajax=function(c,f,d){if(arguments.length==2){dom.ajax(arguments[0],null,arguments[1])}var e=new XMLHttpRequest();if(e){e.open(f?"POST":"GET",c,true);e.onreadystatechange=function(){if(e.readyState==4&&e.status==200){var h=e.getResponseHeader("Content-type");var g=e.responseText;if(h.indexOf("json")!=-1){g=JSON.parse(g)}d(g)}};if(f){var a=[];for(var b in f){a.push(encodeURIComponent(b)+"="+encodeURIComponent(f[b]))}e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.send(a.join("&"))}else{e.send()}}return e};dom.redirect=function(c,e){if(e){var d=document.createElement("form");d.method="post";d.action=c;d.style.display="none";document.body.appendChild(d);for(var b in e){var a=document.createElement("input");a.type="hidden";a.name=b;a.value=e[b];d.appendChild(a)}d.submit()}else{window.location=c}};dom.loadScript=function(a,c){var b=document.createElement("script"),d=0;b.type="text/javascript";b.src=a;b.async=true;b.onload=b.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState=="complete")){d=1;c()}};document.getElementsByTagName("head")[0].appendChild(b)};return dom}());var ui=(function(){var a={};a.is_mobile_browser=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)};a.tabs=function(h){var g=[];var b=function(i,j){var l=j.className;var k={label:function(m){return i.textContent=m},hide:function(){i.className="label";j.className=l;j.style.display="none"},show:function(){i.className="label selected";j.className=l+" selected";for(var m=0;m<g.length;++m){if(k!=g[m]){g[m].hide()}}j.style.display="block"}};i.onclick=k.show;return k};var f=document.createElement("ul");f.className="switch";for(var e=0;e<h.childNodes.length;++e){var d=h.childNodes[e];var c=f.appendChild(document.createElement("li"));c.className="label";c.textContent=d.title;d.title="";g.push(b(c,d))}if(!g.active){g.active=0}g[g.active].show();h.insertBefore(f,h.firstChild);return g};a.waiting=function(d,f){var h={color:"#ff8000",looptime:2000,squares:10,space:1};if(f){for(var j in f){if(typeof h[j]!=="undefined"){h[j]=f[j]}}}var g=false,p=0,q=1,s=0,o=[];var c=10,r=10;if(d.clientWidth){c=parseInt(d.clientWidth/h.squares-h.space)}if(d.clientHeight){r=d.clientHeight}for(var m=0;m<h.squares;++m){var b=d.appendChild(document.createElement("div"));b.style.width=c+"px";b.style.height=r+"px";b.style.position="absolute";b.style.left=""+(m*(c+h.space))+"px";o.push(b)}var n=function(){var e=p;var t=q;o[e].style.backgroundColor="";for(var k=1;k<h.squares;++k){if(e==0){t=1}else{if(e==h.squares-1){t=-1}}e+=t;o[e].style.backgroundColor=h.color;o[e].style.opacity=parseInt((100/h.squares)*(k+0.5))/100}if(p==0){q=1}else{if(p==h.squares-1){q=-1}}p+=q};var l={start:function(){g=true;s=setInterval(n,h.looptime/(h.squares*2))},stop:function(){g=false;clearInterval(s)}};return l};return a}());var cpp=(function(){var a={};var c="/ace.js",b="ace/theme/chrome",e="ace/mode/c_cpp";var d=function(f){if(d.ready){f()}else{d.functions.push(f)}};d.functions=[];d.ready=false;dom.loadScript(staticPrefix+c,function(){d.ready=true;for(var f=0;f<d.functions.length;++f){d.functions[f]()}});a.Editor=function(f){var i=null;var j=k(f);var h=f.appendChild(document.createElement("div"));var g={getValue:function(){return i?i.getSession().getValue():""},setValue:function(l){d(function(){i.getSession().setValue(l)})},disable:function(m,l,n){j.show(m,l,n);d(function(){i.setReadOnly(true)})},enable:function(){j.hide();d(function(){i.setReadOnly(false)})},setAnnotations:function(l){d(function(){if(l){i.getSession().setAnnotations(l)}else{i.getSession().clearAnnotations()}})},resize:function(m,l){h.style.width=m+"px";h.style.height=l+"px";d(function(){i.resize(true)})},onReady:function(l){if(i){l()}else{d(l)}}};d(function(){i=ace.edit(h);i.getSession().setMode("ace/mode/c_cpp");i.setShowPrintMargin(false);i.setBehavioursEnabled(false)});return g;function k(n){var p=n.appendChild(document.createElement("div"));p.className="EditorWait";p.style.position="absolute";p.style.top=0;p.style.left=0;p.style.width="100%";p.style.height="100%";p.style.overflow="hidden";p.style.zIndex=99;p.style.backgroundColor="rgba(224,224,224,0.5)";var m=p.appendChild(document.createElement("div"));m.style.position="absolute";m.style.top=0;m.style.left=0;m.style.bottom=0;m.style.right=0;m.style.margin="auto";m.style.height="64px";m.style.width="70%";m.style.textAlign="center";var r=m.appendChild(document.createElement("h3"));var s=m.appendChild(document.createElement("div"));s.style.position="relative";s.style.width="220px";s.style.height="20px";s.style.margin="auto";var o=m.appendChild(document.createElement("b"));var l=ui.waiting(s);var q={show:function(u,t,v){r.textContent=u?u:"Please, wait";o.textContent=t?t:"";if(v){l.start();s.style.visibility="visible"}else{l.stop();s.style.visibility="hidden"}p.style.display=""},hide:function(){l.stop();p.style.display="none"}};q.hide();n.appendChild(p);return q}};a.Button=function(f,i){var h=f.appendChild(document.createElement("a"));h.href="#";h.className=i?i:"btn";var g={enable:function(k,j){h.title=k;h.textContent=k;h.onclick=function(){if(j){j()}return false}},disable:function(){h.onclick=function(){return false}}};return g};a.Terminal=function(g,i){var f={bgColor:g.style.backgroundColor||"#000",fgColor:g.style.color||"#eee"};if(i){for(var s in f){if(typeof i[s]!=="undefined"){f[s]=i[s]}}}g.setAttribute("tabindex",0);g.setAttribute("spellcheck","false");g.style.whiteSpace="pre";g.style.wordWrap="break-word";var j={};(function(){var k=g.appendChild(document.createElement("div"));k.style.minHeight="125px";j.content=h(k.appendChild(document.createElement("span")));j.buffer=p(k.appendChild(document.createElement("span")));j.caret=x(k.appendChild(document.createElement("span")),"#000","#bbb");var y=g.appendChild(document.createElement("div"));y.style.backgroundColor="#ddd";y.style.color="#666";j.status=h(y)}());var w={};var l=false;var m=false;var v=function(k){if(k.preventDefault){k.preventDefault()}if(k.stopPropagation){k.stopPropagation()}if(k.stopImmediatePropagation){k.stopImmediatePropagation()}return false};var r=function(y){if(!l){return}var y=y||window.event;var k=y.charCode||y.which||y.keyCode;if(!k||y.altKey||y.ctrlKey||y.metaKey){return}var z=String.fromCharCode(k);if(z){j.buffer.append(z);j.caret.blink();return v(y)}};var u=function(k){if(!l){return}var k=k||window.event;switch(k.keyCode){case 8:j.buffer.backspace();j.caret.blink();return v(k);case 9:j.buffer.append("\t");j.caret.blink();return v(k);case 13:j.buffer.append("\n");o();return v(k);case 67:if(k.ctrlKey){w.kill("SIGINT");return v(k)}break}};var q=function(){m=true;if(l){j.caret.blink()}};var t=function(){m=false;j.caret.stop()};var n;var o=function(){var k=j.buffer.flush();j.content.append(k);n.emit("data",k)};w.set=function(y,k){j.content.set(y?y:"");j.status.set(k?k:"")};w.clean=function(){w.set()};w.begin=function(k){if(l){w.end()}l=true;j.content.set("");j.status.set("");j.caret.enable();if(!n){n=io.connect();n.on("connect",function(){console.log("connected")});n.on("data",function(y){w.write(y)});n.on("termend",function(y){w.end(y)});n.on("disconnect",function(y){console.log("disconnected!")})}n.emit("hashid",k);g.addEventListener("keypress",r,false);g.addEventListener("keydown",u,false);g.addEventListener("focusin",q,false);g.addEventListener("focusout",t,false);g.focus()};w.kill=function(k){n.emit("termend",k)};w.end=function(k){j.content.append(j.buffer.flush());j.status.set(k?k:"");l=false;j.caret.stop();j.caret.disable();g.removeEventListener("keypress",r,false);g.removeEventListener("keydown",u,false);g.removeEventListener("focusin",q,false);g.removeEventListener("focusout",t,false);w.onExit()};w.write=function(k){j.content.append(k)};return w;function h(k){var y={set:function(z){k.textContent=z},append:function(z){k.textContent+=z}};return y}function p(y){var z="";var A=function(){if(typeof y.textContent!=="undefined"){y.textContent=z}else{y.innerText=z}};var k={append:function(B){z+=B;A()},backspace:function(){z=z.substr(0,z.length-1);A()},flush:function(){var B=z;z="";A();return B}};return k}function x(A,C,B){var z=false;var y=null;A.innerHTML="&nbsp;";var k=function(){var E="";if(y){if(k.state){E=C}k.state=!k.state}else{if(z){E=B}}A.style.backgroundColor=E};k.state=true;k();var D={enable:function(){z=true;k()},disable:function(){z=false;k()},blink:function(){if(y){clearInterval(y)}y=setInterval(k,500);state=true;k()},stop:function(){if(y){clearInterval(y)}y=null;k()}};return D}};a.Options=function(j,i){var h=document.createElement("ul");var f=[];var k=function(t,m,r,s,n,p){var v=document.createElement("li");v.className="optgroup";v.title=r;v.textContent=t;var q=document.createElement("ul");v.appendChild(q);h.appendChild(v);var o=function(z,A){var x=document.createElement("li");q.appendChild(x);var w=document.createElement("input");w.type=s;w.name=m;w.value=z;w.id=z;if(p){w.onclick=p}x.appendChild(w);if(i[m]&&i[m]==z){w.checked=true}var y=document.createElement("label");y.htmlFor=z;y.textContent=A;x.appendChild(y);return w};for(var u in n){f.push(o(u,n[u]))}return q};k("Standard","dlct","Select a C++ standard version","radio",{cpp98:"C++98",cpp11:"C++11",cpp14:"C++14"});k("Warnings","wrng","Choose warning levels (multiple)","checkbox",{Wall:"Many (-Wall)",Wextra:"Extra (-Wextra)",Wpedantic:"Pedantic (-Wpedantic)"});k("Optimization level","optm","Optimization: Lower for faster compilation, higher for faster execution","radio",{O0:"None (-O0)",O1:"Moderate (-O1)",O2:"Full (-O2)",O3:"Maximum (-O3)"});k("Standard Input","inpt","Choose a method to introduce input","radio",{none:"None",interactive:"Interactive",text:"Text:"},function(){l.disabled=(g.checked)?false:true});var g=f[f.length-1];var l=document.createElement("textarea");l.className="itext";l.name="stdin";l.cols=20;l.rows=4;l.maxLength=5000;l.disabled=true;g.parentElement.appendChild(l);j.appendChild(h);j.appendChild(document.createElement("div"));j.lastChild.style.clear="both";return{get:function(){var m={dlct:"",wrng:"",optm:"",inpt:""};for(var n=0;n<f.length;++n){if(f[n].checked){m[f[n].name]+=(m[f[n].name]?" ":"")+f[n].value}}if(g.checked){m.stdin=l.value}return m}}};a.App=function(i,o){var h={ajax:true};if(o){for(var l in h){if(typeof o[l]!=="undefined"){h[l]=o[l]}}}var f={};(function(){var s=i.appendChild(document.createElement("div"));s.className="top";f.editor=a.Editor(s);var t=i.appendChild(document.createElement("div"));t.className="middle";f.bigButton=a.Button(t,"btnm");if(h.ajax){var r=a.Button(t,"btn").enable("Get URL",function(){j.url()})}else{var u=t.appendChild(document.createElement("span"));u.innerHTML='Short URL: <a href="http://cpp.sh'+window.location.pathname+'">cpp.sh'+window.location.pathname+"</a>"}var k=i.appendChild(document.createElement("div"));k.className="bottom";var w=k.appendChild(document.createElement("div"));w.className="sheet terminal";w.title="options";f.opt=a.Options(w,{dlct:"cpp14",wrng:"Wall",optm:"O2",inpt:"interactive"});var p=k.appendChild(document.createElement("div"));p.className="sheet terminal pre";p.title="compilation";f.compilation={update:function(x){p.textContent=x}};var v=k.appendChild(document.createElement("div"));v.className="sheet terminal";v.title="execution";f.term=a.Terminal(v);var q=ui.tabs(k);f.tabs={opts:q[0],build:q[1],exec:q[2]}}());var g={loading:function(){f.editor.disable("Please, wait","Loading",true);f.bigButton.disable()},editing:function(){f.editor.enable();f.bigButton.enable("Run",j.build)},building:function(){f.editor.disable("Please, wait","Compiling",true);f.bigButton.enable("Cancel",j.build.cancel);f.tabs.build.show()},running:function(){f.editor.disable("Program running","",false);f.bigButton.enable("Stop",j.exec.cancel);f.tabs.exec.show()}};var j={};j.edit=function(k){if(typeof k!=="undefined"){f.editor.onReady(function(){if(typeof k.source!=="undefined"&&k.source!=f.editor.getValue()){f.editor.setValue(k.source)}j.edit.params=k;if(typeof k.autorun!=="undefined"){return j.build()}})}g.editing()};j.getParams=function(){var k=f.opt.get();k.source=f.editor.getValue();return k};var m;j.build=function(){f.editor.setAnnotations();f.compilation.update("");f.term.clean();var p=j.getParams();if((!h.ajax)&&(j.edit.params)&&(p.source!=j.edit.params.source)){p.autorun=true;dom.redirect("/",p)}else{var k=(p.inpt=="interactive");g.building();m=dom.ajax(k?"/irun":"/run",p,function(r){if(m){m=null;if(r.error){console.log("Operation failed.")}else{if(typeof r.result.gcc_err!=="undefined"){var q=r.result.gcc_err.replace(/<stdin>:/g,"")+" ";f.compilation.update(q);f.editor.setAnnotations(n(r.result.gcc_err))}}if(r.result.success){if(k){j.exec(r.result.hashid)}else{f.term.set(r.result.output,r.result.exitmsg);f.tabs.exec.show();g.editing()}}else{g.editing()}}})}};j.build.cancel=function(){if(m){m.abort()}m=null;g.editing()};j.exec=function(k){g.running();f.term.onExit=function(){g.editing()};f.term.begin(k)};j.exec.cancel=function(){f.term.end("Program stopped");f.term.kill("SIGKILL")};j.url=function(){dom.ajax("/url",j.getParams(),function(k){window.location="/"+k.shortid})};j.resize=function(){var p="";if(window.innerWidth>816){p=(window.innerWidth-176)+"px"}else{if(window.innerWidth>656){p="640px"}else{if(window.innerWidth<336){p="320px"}}}i.style.width=p;var k=window.innerHeight>560?window.innerHeight-320:240;f.editor.resize(p-6,k)};var n=function(u){var k=u.split(/\r?\n/);var r=[];for(var p=0;p<k.length;++p){var t=k[p].split(":");var s=t.slice(1).join(":");if(t.length>4){var q=(t[3]==" warning")?"warning":"error";r.push({row:t[1]-1,column:t[2]-1,type:q,text:s})}}return(r)};j.resize();window.addEventListener("resize",j.resize,false);g.loading();f.editor.onReady(function(){g.editing()});return j};return a}());